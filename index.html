<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Board Game Timer - Active/Inactive Players</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%; overflow: hidden;
      font-family: sans-serif;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      touch-action: manipulation;
      background: white;
    }

    #timer {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(0deg);
      font-size: 20vmin;
      color: #333;
      transition: color 0.2s ease, transform 0.3s ease, opacity 0.3s ease;
      user-select: none;
      cursor: pointer;
      opacity: 1;
      text-align: center;
      user-select: none;
    }

    #skipOverlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.6);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      color: white;
      font-size: 5vmin;
      visibility: hidden;
      opacity: 0;
      transition: opacity 0.3s ease;
      user-select: none;
      padding: 10px;
    }

    #skipOverlay.visible {
      visibility: visible;
      opacity: 1;
    }

    .skipButton {
      background: #2980b9;
      border: none;
      margin: 10px;
      padding: 15px 30px;
      border-radius: 10px;
      cursor: pointer;
      font-size: 6vmin;
      min-width: 120px;
      transition: background-color 0.3s ease;
      user-select: none;
    }

    .skipButton.selected {
      background: #27ae60;
    }

    #closeSkipOverlay {
      background: #e74c3c;
      margin-top: 30px;
      min-width: 160px;
    }
  </style>
</head>
<body>

  <div id="timer">40</div>

  <div id="skipOverlay">
    <div>Select active players (toggle):</div>
    <div id="skipButtonsContainer"></div>
    <button id="closeSkipOverlay" class="skipButton">Resume Timer</button>
  </div>

<script>
  const START_TIME = 40;
  const playersCount = 4;
  const timerElement = document.getElementById('timer');
  const skipOverlay = document.getElementById('skipOverlay');
  const skipButtonsContainer = document.getElementById('skipButtonsContainer');
  const closeSkipOverlay = document.getElementById('closeSkipOverlay');

  let countdown = START_TIME;
  let intervalId;
  let rotation = 0; // degrees for rotate
  let isPaused = false;
  let longPressTimeout;
  let lastInputTime = 0;

  const colors = ['#333', '#e74c3c', '#2980b9', '#27ae60'];
  let colorIndex = 0;

  // Track active/inactive players (true=active)
  let playersActive = [true, true, true, true];
  let currentPlayer = 0; // 0-based index

  // Render toggle buttons for players
  function renderSkipButtons() {
    skipButtonsContainer.innerHTML = '';
    for (let i = 0; i < playersCount; i++) {
      const btn = document.createElement('button');
      btn.classList.add('skipButton');
      btn.textContent = `Player ${i + 1}`;
      btn.classList.toggle('selected', playersActive[i]);
      btn.onclick = () => {
        playersActive[i] = !playersActive[i];
        renderSkipButtons();
      };
      skipButtonsContainer.appendChild(btn);
    }
  }

  // Rotate timer and update color based on currentPlayer
  function rotateTimer() {
    rotation = currentPlayer * 90;
    timerElement.style.transform = `translate(-50%, -50%) rotate(${rotation}deg)`;
    colorIndex = currentPlayer % colors.length;
    timerElement.style.color = colors[colorIndex];
  }

  // Move to next active player
  function nextPlayer() {
    let tries = 0;
    do {
      currentPlayer = (currentPlayer + 1) % playersCount;
      tries++;
      if (tries > playersCount) {
        // No active players, just stay on current
        break;
      }
    } while (!playersActive[currentPlayer]);
  }

  // Ensure currentPlayer is active, or pick next active
  function ensureCurrentPlayerActive() {
    if (!playersActive[currentPlayer]) {
      nextPlayer();
    }
  }

  function tick() {
    if (!isPaused) {
      countdown--;
      timerElement.textContent = countdown;
      if (countdown <= 0) {
        clearInterval(intervalId);
        nextPlayer();
        rotateTimer();
        startCountdown();
      }
    }
  }

  function startCountdown() {
    clearInterval(intervalId);
    ensureCurrentPlayerActive();

    countdown = START_TIME;
    timerElement.textContent = countdown;

    rotateTimer();

    isPaused = false;
    timerElement.style.opacity = 1;

    intervalId = setInterval(tick, 1000);
  }

  function showSkipOverlay() {
    renderSkipButtons();
    skipOverlay.classList.add('visible');
  }

  function hideSkipOverlay() {
    skipOverlay.classList.remove('visible');
  }

  function setupLongPressPause() {
    function startLongPressTimer() {
      lastInputTime = Date.now();
      longPressTimeout = setTimeout(() => {
        isPaused = true;
        timerElement.style.opacity = 0.5;
        showSkipOverlay();
      }, 500);
    }

    function cancelLongPress() {
      clearTimeout(longPressTimeout);
      if (Date.now() - lastInputTime < 500) {
        // Short tap
        if (isPaused) {
          isPaused = false;
          timerElement.style.opacity = 1;
          hideSkipOverlay();
        } else {
          startCountdown();
        }
      }
    }

    document.body.addEventListener('mousedown', startLongPressTimer);
    document.body.addEventListener('mouseup', cancelLongPress);
    document.body.addEventListener('mouseleave', cancelLongPress);

    document.body.addEventListener('touchstart', startLongPressTimer);
    document.body.addEventListener('touchend', cancelLongPress);
    document.body.addEventListener('touchcancel', cancelLongPress);
  }

  closeSkipOverlay.onclick = () => {
    isPaused = false;
    timerElement.style.opacity = 1;
    hideSkipOverlay();
  };

  // Init
  setupLongPressPause();
  startCountdown();
</script>
</body>
</html>
